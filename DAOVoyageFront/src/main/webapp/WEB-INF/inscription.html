<!DOCTYPE html>
<html
	th:replace="~{ fragments/layout.html :: layout('Inscription', ~{ ::body }) }">
<body class="container-fluid">
	<main class="row">
		<div class="centre col-10">
			<h1>Inscription</h1>
			<br />
			<div class="row">
				<div class="col-2"></div>
				<div class="cadreInscription col-8">
					<div class="jumbotron">
						<div id="titreInscription">
							<h2>Inscrivez vous en moins d'une minute !</h2>
						</div>
						<br />
						<div>Veuillez renseigner les champs suivants :</div>
						<br />
						<form id="form" method="POST" action="inscription">
							<div>
								</br> <input id="login" class="form-control" type="text" name="login"
									th:value="${session.login}" placeholder="Identifiant" required />
							</div>
							<div>
								</br> <input id="checkMail" class="form-control" type="email"
									name="adresseMail"
									placeholder="Adresse e-mail" required />
							</div>
							</br/>
							<div>
							<span id="mailValid" class="valid" style="display: none;">Adresse mail valide</span>
							<span id="mailNotValid" class="error" style="display: none;">Adresse mail incorrecte ou déjà utilisée</span>
							</div>
							<div>
								<br /> <input class="form-control" type="password"
									name="password" id="password" th:value="${session.password}"
									placeholder="Mot de passe" required />
							</div>
							<div>
								<br /> <input class="form-control" type="password"
									name="confirm_password" id="confirm_password"
									placeholder="Confirmez le mot de passe" required /><br />
							</div>
							<br />
							<div>
								<input type="submit" class="btn btn-info" value="S'inscrire" />
							</div>
						</form>
					</div>
				</div>
			</div>
	</main>
	<script>
	/*
$(document).ready(function() {
	var $submitBtn = $("#form input[type='submit']");
	var $passwordBox = $("#password");
	var $confirmBox = $("#confirm_password");
	var $errorMsg = $('<span class="error" id="error_msg">Les mots de passes sont différents</span>');

	// This is incase the user hits refresh - some browsers will maintain the disabled state of the button.
	$submitBtn.removeAttr("disabled");

	function checkMatchingPasswords() {
		if ($confirmBox.val() != "" && $passwordBox.val != "") {
			if ($confirmBox.val() != $passwordBox.val()) {
				$submitBtn.attr("disabled", "disabled");
				$errorMsg.insertAfter($confirmBox);
			}
		}
	}

	function resetPasswordError() {
		$submitBtn.removeAttr("disabled");
		var $errorCont = $("#error_msg");
		if ($errorCont.length > 0) {
			$errorCont.remove();
		}
	}

	$("#confirm_password, #password").on("keydown",function(e) {
			/* only check when the tab or enter keys are pressed
			 * to prevent the method from being called needlessly  */
			 /*
			if (e.keyCode == 13 || e.keyCode == 9) {
				checkMatchingPasswords();
			}
		}).on("blur", function() {
		// also check when the element looses focus (clicks somewhere else)
			checkMatchingPasswords();
		}).on("focus", function() {
		// reset the error message when they go to make a change
		resetPasswordError();
	})
});
*/



$('#checkMail').blur(function() {
	let mail = document.querySelector('#checkMail').value;
	console.log(mail);
	if (mail.length > 5) {
		console.log('mail length');
		fetch('inscription/checkMail', {
			method: 'POST',
			body: mail,
		})
		.then(resp => {
			if (resp == "notValid") {
				//"L'adresse est incorrecte ou déjà utilisée"
				console.log('notvalid');
				$('#mailNotValid').style.display = 'block';
				$('#mailValid').style.display = 'none';
			}
			else if (resp == "valid") {
				//"Adresse valide"
				console.log('notvalid');
				$('#mailNotValid').style.display = 'none';
				$('#mailValid').style.display = 'block';
			}
			
		});
	}
});

</script>
</body>

</html>